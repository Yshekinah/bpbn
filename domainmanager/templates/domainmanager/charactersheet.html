{% extends 'base.html' %}
{% load lineage %}
{% load staticfiles %}
{% load customTags %}

{% block title %}Character: {{ character.firstname }} {{ character.lastname }} {% endblock %}

{% block content %}
    <div class="container">
        <div class="col-md-12">

            {% block panel-nav %}
                <div class="panel-heading">
                    <ul class="nav nav-tabs">
                        <li class="{% ancestor 'domainmanager:charactersheet' character.id %}"><a
                                href="{% url 'domainmanager:charactersheet' character.id %}">Charactersheet</a></li>
                        <li class="{% ancestor 'domainmanager:characterxps' character.id %}"><a
                                href="{% url 'domainmanager:characterxps' character.id %}">XP</a></li>
                        <li class="{% ancestor 'domainmanager:characterbasket' character.id %}"><a
                                href="{% url 'domainmanager:characterbasket' character.id %}">Basket</a></li>
                        {% if character.domain.boons == True %}
                            <li class="{% ancestor 'domainmanager:characterboons' character.id %}"><a
                                    href="{% url 'domainmanager:characterboons' character.id %}">Boons</a></li>
                        {% endif %}
                        {% if character.domain.downtimes == True %}
                            <li class="{% ancestor 'domainmanager:characteractions' character.id %}"><a
                                    href="{% url 'domainmanager:characteractions' character.id %}">Downtimes</a></li>
                        {% endif %}
                        {% if character.domain.secrets == True %}
                            <li class="{% ancestor 'domainmanager:charactersecrets' character.id %}"><a
                                    href="{% url 'domainmanager:charactersecrets' character.id %}">Secrets</a></li>
                        {% endif %}
                    </ul>
                </div>
            {% endblock panel-nav %}


            <div id="myModal" class="modal fade">
                <div class="modal-dialog">

                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
                            </button>
                            <h4 class="modal-title">Edit character header information</h4>
                        </div>
                        <div class="modal-body">
                            <p>Loading...</p>
                        </div>
                    </div>
                </div>
            </div>

            {% block characterheader %}
                <div class="panel panel-default">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-md-6">
                            <h3>{{ character.salutation }} {{ character.firstname }} {{ character.lastname }} <a href="#"
                                                                                                                 onclick="javascript:changeHeaderInformation()"
                                                                                                                 class="top-menu"><span
                                    class="glyphicon glyphicon-pencil"></span></a>
                                <a href="#" onclick="javascript:window.print()" class="top-menu"><span
                                        class="glyphicon glyphicon-print"></span></a>
                            </h3>
                            <div class="row">
                                <div class="col-md-3">Level up <span class="glyphicon glyphicon-info-sign"
                                                                     onclick="javascript:showInfoDialog('Level up','When checked you can level up your character')"></span>
                                </div>
                                <div class="col-md-3"><input type="checkbox" id="level-up" onchange="setLevelUp()" data-reverse></div>
                            </div>
                            <div id="div-quick-edit" class="row" style="padding-top: 4px">
                                <div class="col-md-3">Quick edit <span class="glyphicon glyphicon-info-sign"
                                                                       onclick="javascript:showInfoDialog('Quick edit','When checked the character editor will not ask for confirmation to level up.')"></span>
                                </div>
                                <div class="col-md-3"><input type="checkbox" id="quick-edit" onchange="setQuickEdit()" data-reverse></div>

                            </div>
                        </div>


                        <div class="col-md-*" align="right" style="padding-right:10px">
                            {% if character.clan.image %}
                                <img src="{{ character.clan.image.url }}" alt="Clan logo" height="100px" width="auto"/>
                            {% endif %}
                            {% if character.function.image %}
                                <img src="{{ character.function.image.url }}" alt="Political function logo" height="100px" width="auto"/>
                            {% endif %}
                            {% if character.sect.image %}
                                <img src="{{ character.sect.image.url }}" alt="Sect logo" height="100px" width="auto"/>
                            {% endif %}
                            {% if character.rank.image %}
                                <img src="{{ character.rank.image.url }}" alt="Rank logo" height="100px" width="auto"/>
                            {% endif %}
                        </div>

                    </div>
                </div>

                <div class="panel-body">
                <div class="row">
                    <div class="col-md-4">
                        <div class="row">
                            <div class="col-md-4">
                                Domain:
                            </div>
                            <div class="col-md-6">
                                {{ character.domain }}
                            </div>
                        </div>
                        {% if character.nickname != None %}
                            <div class="row">
                                <div class="col-md-4">
                                    Nickname:
                                </div>
                                <div class="col-md-6">
                                    {{ character.nickname }}
                                </div>
                            </div>
                        {% endif %}

                        <div class="row">
                            <div class="col-md-4">
                                Player:
                            </div>
                            <div class="col-md-6">
                                {{ character.player }}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        {% if character.sire != None %}
                            <div class="row">
                                <div class="col-md-4">
                                    Sire:
                                </div>
                                <div class="col-md-6">
                                    {{ character.sire.salutation }} {{ character.sire.firstname }} {{ character.sire.lastname }}
                                </div>
                            </div>{% endif %}
                        {% if character.clan != None %}
                            <div class="row">
                                <div class="col-md-4">
                                    Clan:
                                </div>
                                <div class="col-md-6">{{ character.clan.name }}</div>
                            </div>{% endif %}
                        {% if character.generation != None %}
                            <div class="row">
                                <div class="col-md-4">
                                    Generation:
                                </div>
                                <div class="col-md-6">
                                    {{ character.generation }}
                                </div>
                            </div>{% endif %}
                        {% if character.rank != None %}
                            <div class="row">
                                <div class="col-md-4">
                                    Rank:
                                </div>
                                <div class="col-md-6">{{ character.rank }}</div>
                            </div>{% endif %}

                    </div>
                    <div class="col-md-4">
                        <div class="row">
                            <div class="col-md-4">Willpower:</div>
                            <div class="col-md-6">{{ character.willpower }} </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">Frenzy points:</div>
                            <div class="col-md-6">{{ character.frenzy }}</div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">Bloodpool:</div>
                            <div class="col-md-6">{{ character.bloodpool }}</div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">XP left :</div>
                            <div class="col-md-6">{{ xpleft }} </div>
                        </div>
                    </div>
                </div>

            {% endblock characterheader %}

            {% block characterproperties %}

                <div class="row">
                    <div class="col-md-4">
                        {% renderCharacterSheetSection 'Physical' physical %}
                    </div>
                    <div class="col-md-4">
                        {% renderCharacterSheetSection 'Social' social %}
                    </div>
                    <div class="col-md-4">
                        {% renderCharacterSheetSection 'Mental' mental %}
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-4">
                        {% renderCharacterSheetSection 'Talents' talents %}
                    </div>
                    <div class="col-md-4">
                        {% renderCharacterSheetSection 'Skills' skills %}
                    </div>
                    <div class="col-md-4">
                        {% renderCharacterSheetSection 'Knowledges' knowledges %}
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-4">
                        {% renderCharacterSheetSection 'Disciplines' disciplines %}
                    </div>
                    {% if influences %}
                        <div class="col-md-4">
                            {% renderCharacterSheetSection 'Influences' influences renderButton=True maxValue=3 %}
                        </div>
                    {% endif %}
                    <div class="col-md-4">
                        {% if backgrounds %}
                            <div class="row">
                                <div class="col-md-12">
                                    {% renderCharacterSheetSection 'Backgrounds' backgrounds showValue=True %}
                                </div>
                            </div>
                        {% endif %}
                        {% if merits %}
                            <div class="row">
                                <div class="col-md-12">
                                    {% renderCharacterSheetSection 'Merits' merits showValue=False %}
                                </div>
                            </div>
                        {% endif %}
                        {% if flaws %}
                            <div class="row">
                                <div class="col-md-12">
                                    {% renderCharacterSheetSection 'Flaws' flaws showValue=False %}
                                </div>
                            </div>
                        {% endif %}
                    </div>
                </div>
                <div class="row">
                    {% if thaumaturgicpaths %}
                        <div class="col-md-4">
                            {% renderCharacterSheetSection 'Thaumaturgic paths' thaumaturgicpaths %}
                        </div>
                    {% endif %}
                    {% if rituals %}
                        <div class="col-md-4">
                            {% renderCharacterSheetSection 'Rituals' rituals %}
                        </div>
                    {% endif %}
                    {% if necromanticpaths %}
                        <div class="col-md-4">
                            {% renderCharacterSheetSection 'Necromantic paths' necromanticpaths %}
                        </div>
                    {% endif %}
                </div>

            {% endblock characterproperties %}
            </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        {% autoescape off %}

            function changeHeaderInformation() {
                $('#myModal').modal('show').find('.modal-body').load('{% url 'domainmanager:characterinformation_edit' character.pk %} ');
            }

            function showInfoDialog(title, text) {
                BootstrapDialog.show({
                    title: title,
                    message: text
                });
            }

            function showLvlDialog(propId, propValue, propName, xpCost) {

                if ($('#quick-edit').is(':checked')) {
                    window.location.href = "http://{{ request.get_host }}/domainmanager/lvlup/" + propId;
                } else {

                    BootstrapDialog.show({
                        message: 'Do you really want to raise ' + propName + " to " + (propValue + 1) + "?\n" + 'This will cost ' + xpCost + ' XP',
                        buttons: [{
                            label: 'Ok',
                            cssClass: 'btn-primary',
                            action: function () {
                                window.location.href = "http://{{ request.get_host }}/domainmanager/lvlup/" + propId;
                            }
                        }, {
                            icon: 'glyphicon glyphicon-ban-circle',
                            label: 'Cancel',
                            cssClass: 'btn-warning',
                            action: function (dialogItself) {
                                dialogItself.close();
                            }
                        }]
                    });
                }
            }

            $(document).ready(function () {

                $(':checkbox').checkboxpicker();
                updateVisibility();
            });

            function setLevelUp() {

                value = $('#level-up').is(':checked');
                if (value == true) {
                    Cookies.set('level-up', 'yes', {expires: 7});
                } else {
                    Cookies.set('level-up', 'no', {expires: 7});
                }
                updateVisibility();
            }

            function setQuickEdit() {

                value = $('#quick-edit').is(':checked');
                if (value == true) {
                    Cookies.set('quick-edit', 'yes', {expires: 7});
                } else {
                    Cookies.set('quick-edit', 'no', {expires: 7});
                }
                updateVisibility();
            }

            function updateVisibility() {
                value = Cookies.get('level-up');
                if (value == 'yes') {
                    $('#level-up').prop('checked', true);
                    $('#div-quick-edit').show();
                    $('.btn-level-up').show();
                    $('.col-level-up').show();
                } else {
                    $('#level-up').prop('checked', false);
                    $('#div-quick-edit').hide();
                    $('.btn-level-up').hide();
                    $('.col-level-up').hide();
                }

                value = Cookies.get('quick-edit');
                if (value == 'yes') {
                    $('#quick-edit').prop('checked', true);
                } else {
                    $('#quick-edit').prop('checked', false);
                }
            }

        {% endautoescape %}
    </script>

{% endblock %}